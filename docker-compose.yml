version: '3'

services:
    memcached:
        image: memcached:alpine

    postgres:
        image: mdillon/postgis
        environment:
            POSTGRES_PASSWORD: "${DATABASE_PASSWORD:-password123}"
        ports:
            - '5432:5432'
        restart: always

    server:
        build: ./
        links:
           - postgres
        environment:
           - GUNICORN_WORKERS=2
           - GUNICORN_BIND=unix:/socks/gunicorn.sock
        volumes:
            - socks:/socks
            - static_files:/var/www/dp_server/assets
        restart: always

    nginx:
        image: nginx:alpine
        ports:
            - 8443:443
            - 8000:80
        volumes:
            - ./conf/nginx.conf:/etc/nginx/nginx.conf:ro
            - ./conf/ssl:/etc/nginx/ssl:ro
            - static_files:/var/www/dp_server/assets
            - socks:/socks
        restart: always

volumes:
    socks:
    static_files: