authorizedkeys:
  autodestroy: always
  deployment_strategy: every_node
  environment:
    - AUTHORIZED_KEYS=ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEAu298P73mNQmwGIih1KNUqacksioF6CazH5nM39X+lzP/+ebTQQvU/I0WCyZRTA+VGyloYpQxWC969dimj6e34hpCdcWcuHl1wr3afLpd7RqcUnaubLins3s5xStWD5oNWREkZ/mpqUWgPWEQsG7n1cADW0Es4UyM0jzz/wo8wNE=
  image: 'dockercloud/authorizedkeys:latest'
  volumes:
    - '/root:/user'
django:
  command: /run_server.sh
  environment:
    - DATABASE_PASSWORD=databasepassword
    - ENV=production
    - RABBITMQ_DEFAULT_PASS=mypass
    - RABBITMQ_DEFAULT_USER=myuser
    - SECRET_KEY=wowbigsecret
  image: 'fraserthompson/doctorpricerscrapers:latest'
  links:
    - memcached
    - postgres
    - rabbit
    - worker
  restart: always
  volumes:
    - /socks
    - /var/www/dp_server/assets
memcached:
  image: 'memcached:alpine'
nginx:
  image: 'fraserthompson/doctorpricernginx:latest'
  ports:
    - '80:80'
    - '443:443'
  restart: always
  volumes_from:
    - django
postgres:
  environment:
    - POSTGRES_PASSWORD=databasepassword
  image: 'mdillon/postgis:latest'
  ports:
    - '5432'
  restart: always
rabbit:
  environment:
    - RABBITMQ_DEFAULT_PASS=mypass
    - RABBITMQ_DEFAULT_USER=myuser
  hostname: rabbit
  image: 'rabbitmq:3.6.0'
  ports:
    - '5672:5672'
    - '15672:15672'
worker:
  command: /run_celery.sh
  environment:
    - DATABASE_PASSWORD=databasepassword
    - ENV=production
    - RABBITMQ_DEFAULT_PASS=mypass
    - RABBITMQ_DEFAULT_USER=myuser
    - SECRET_KEY=wowbigsecret
  image: 'fraserthompson/doctorpricerscrapers:latest'
  links:
    - memcached
    - postgres
    - rabbit
  restart: always